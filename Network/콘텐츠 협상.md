# 콘텐츠 협상과 서버 주도 콘텐츠 협상

## 콘텐츠 협상
> HTTP에서 콘텐츠 협상(Content negotiation)이란 **동일한 URI**에서 리소스의 **서로 다른 버전**을 제공하기 위해 사용하는 `메커니즘`으로,
사용자 에이전트가 사용자에게 제일 잘 맞는 것이 무엇인지(예를 들어, 문서의 언어, 이미지 포맷 혹은 컨텐츠 인코딩에 있어 어떤 것이 적절한지)를 명시할 수 있습니다.

원문에서는 어렵게 작성되어 있으나 쉽게 풀어서 설명하자면, **클라이언트와 서버간에 요청된 리소스**를 제공할 때,
콘텐츠 형식(Content-Type)에 대해 **협상**하는 과정이다.

## 콘텐츠 협상의 원칙

우리가 기본적으로 `API`라고 불리우는 서버의 URL에 클라이언트가 리소스를 요청할 경우,
서버에서는 이를 클라이언트가 원하는 특정 프레젠테이션(Response Entity 혹은 DTO)를 반환해준다.

![content-type](https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation/httpnego.png)

이에 대해서 서버는 응답이 성공적으로 완료된 경우 200을 반환하지만, 내부적으로 문제가 생길 경우 `300-MULTIPLE_CHOICE` 또는 `406-Not_Acceptable`을 반환하게된다.

### 300과 406
- `300 Multiple Choices`: 클라이언트의 요청에 대해 서버가 여러 개의 응답 중에서 선택할 수 있는 경우에 반환됩니다.
  - 즉, 클라이언트의 요청에 대해 서버가 다양한 콘텐츠 형식이나 버전 등을 제공하는 경우에 사용됩니다.

- `406 Not Acceptable`: 클라이언트의 요청에 대해 서버가 요청한 콘텐츠 형식을 지원하지 않는 경우에 반환됩니다. 
  - 즉, 클라이언트가 Accept 헤더를 사용하여 요청한 콘텐츠 형식을 서버가 지원하지 않는 경우에 사용됩니다.

## 서버 주도 콘텐츠 협상

앞서 말한 콘텐츠 협상의 주도권이 `서버`에 있다는 것을 뜻한다.

서버에서 주도적으로 콘텐츠의 타입을 지정하여 반환해주는 것을 말한다.

서버는 클라이언트의 요청 헤더에서 Accept 헤더 값을 확인하여 서버에서 제공 가능한 콘텐츠 형식 중 가장 적합한 것을 선택하고, 해당 콘텐츠 형식에 대한 정보를 Content-Type 헤더 값으로 클라이언트에게 반환한다.


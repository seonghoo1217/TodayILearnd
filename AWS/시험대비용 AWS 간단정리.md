AWS중간정리
클라우드 컴퓨팅의 6가지이점과 모델
클라우드 컴퓨팅이란 컴퓨팅파워,데이터베이스,스토리지,애플리케이션 및 기타 IT 리소스를 온디맨드로 인터넷을 통해 제공하고 사용한만큼만 비용을 지불하는것.
온디맨드: 이용자의 요구에 따라 서비스를 맞추는 것(데이터베이스의 크기,스토리지 처리량 등),원할 때 IT리소스를 빌려 쓸수 있는 것
클라우드 컴퓨팅을 사용함으로서 인프라를 더 이상 하드웨어로 생각하지않아도 된다. 서버를 돈주고 세팅할필요가없다.
하드웨어형 인프라는 서버공간을 직접운용 하여야하고 물리적보안,직원비용,공간 등 여러 부가 비용이 발생한다. 서버를 사기위한 비용 계획을 철저히 세워야한다. 이러한 물리적서버를 데이터센터라고 부른다.
소프트웨어 인프라는 하드웨어 관리비용이 나가지않을 뿐더러 인터넷을 통해 이용하기 때문에 훨씬 간편하고 유연하다. 소프트웨어 인프라는 실제 물리서버인 데이터센터에서 일부를 빌려쓴다고 생각하면된다.
클라우드 서비스 모델의 종류
Iaas(서비스형 인프라):IT 리소스에 대한 제어능력이 제일 좋다.가장 원초적인 서비스 형태 서버를 aws 콘솔에서 클릭해서 실제데이터센터에 띄워진 서버를 빌려쓰는형태
Paas(서비스형 플랫폼) : IT 리소스에 대한 제어능력 중간.서버 구매이후 만드는 서버 튜닝이 조금 더 간편하다.최적화작업이 생략
Saas(서비스형 소프트웨어): IT 리소스에 대한 제어능력이 제일 낮다.가장 발전된 형태.구글드라이브나 One Driver같은 형태 웹에서 사용이가능한 형태 서비스까지 구축된상태이다.

클라우드 컴퓨팅 배포모델
클라우드 : 퍼블릭 클라우드
하이브리드 : 데이터는 온프레미스에 서비스는 클라우드에 이용하는방식
온프레미스 : 프라이빗 클라우드,자체설비이다.On-Premise
AWS의 보안 : 보안그룹,네트워크 ACL,IAM
온프레미스의 보안: 방화벽,ACL,관리자
AWS의 네트워킹:VPC,ELB
AWS의 컴퓨팅: AMI,EC2
AWS의 스토리지 및 데이터베이스:RDS,S3,EBS
클라우드의 장점1 : 자본비용(Capex)을 가변 비용(Opex)으로 대체할수있다
기존의 온프레미스 환경에서는 데이터센터의 설계 구축비용이 필요했는데 이를 사용한 IT리소스에대한 비용 지불만 하면 되는 것 으로 대체
클라우드의 장점2 : AWS 사용하는 비용을 저렴하게 제공
클라우드의 장점3 : 용량을 미리 추정할 필요가 없다.온디멘드 형태이기 때문에 사용자가 많이 몰리면 서버를 확충시켰다가 사람이 줄어들면 다시 서버를 줄일 수 있다.
클라우드의 장점4 : 리소스 관리 속도가 높아진다.
클라우드의 장점5 : 데이터센터 운영 및 유지비용에 투자할 필요가 없어진다.
클라우드의 장점6: 몇분안에 전세계에 서비스가 가능하다.
WEB Service란? 인터넷을 통해 사용할 수 있는 소프트웨어로 API 상호작용의 요청 및 응답에 대해 XML 또는 JSON같은 표준화된 양식을 사용한다.(API가 가장 중요한 개념으로 정해진 사용방식을 따르면 서비스를 제공받을 수 있다)
AWS(Amazon Web Service)란?: 다양한 클라우드 기반 서비스를 제공하는 클라우드 플랫폼이다.CSP이다.(Cloud Service Provider),온디멘드 형식으로 IT리소스를 제공한다.서비스를 이용한 만큼만 비용을 지불한다.
기존 IT 서비스 구축 방식: 서비스구상 -> 서버 및 장비 구매 ->IDC 공간임대
-> 개발 진행 -> 서비스 시작
타워형 서버:타워처럼 세워져 있는 것
랙 마운트형 서버: 좁은곳에 서버를 더많이 끼우기 위해 만들어진 구조
랙 마운트형 서버는 밀집도가 더 높기 때문에 같은 공간에 타워형 서버보다 더 많은 서버를 구축할 수 있지만 더 많은 열이 발생하고 전기사용량 또한 높다 그래서 온도와 습도 조절이 필요하고 전력공급 또한 관리하여야한다.
서버 간 네트워크 연결: 네트워크란 컴퓨터와 컴퓨터를 잇는 것을 말하기 때문에 서버간의 연결을 위해선 실제 물리적인 케이블로 연결을 해주어야한다. 데이터 센터내에 위치한 서버들은 모두 서로간에 연결이 되어있다. 데이터 센터 외부와연결할 수 있는 통로이다(인터넷으로 데이터 센터에 연결된다는 것을 말한다)

서버 가상화 : 물리적 서버위에 하이퍼 바이저를 설치함으로서 가상 머신이 사용가능하다.(저장소와 연산 처리를 지정할 수 있다.)
IaaS: 네트워크 기능,컴퓨터 서버,스토리지 공간등을 빌려서 사용하는 것
Elastic Compute Cloud(EC2): AWS에서 제공하는 컴퓨팅 서비스를 도와주는 시스템
컴퓨팅 서비스:내가 만든 프로그램을 실행 시킬 수 있는 환경을 제공해주는 서비스 가상머신을 이용한 가상 서버 환경을 제공하여 준다. 물리서버와 차이가 별로없다.가장 대표적인 것이 AWS EC2서비스이다.
EC2:기존 서버에서 실행하는 것과 동일하게 어플리케이션을 호스팅 할 수 있는 가상머신이다. 사용자가 할당 받은 가상머신 한대를 인스턴스라고 하고 인스턴스를 할당받는다는 표현을 쓴다. 인스턴스 별로 원하는 어플리케이션을 실행 시킬 수 있다.
생성한 EC2 인스턴스 퍼블릭 IP로 접속하기: ssh -i ~/.ssh/labsuser.pem ec2-user@ public-ip주소
숨겨진파일목록까지 찾기 명령어 : ls -al
원격서버 관리: 서버상태 모니터링,원격 접속을 위한 관리,서버설정 최적화

원격서버 접속을 위해선:ssh로 접속할 때 private key가 있어야지만 접속이 가능하다.특정사용자만 접속을 받기위한 안정적인방법

Local pc에서 ssh로 EC2로 접속하는방법: putty로 22번 포트를 TCP형태로 인스턴스의 퍼블릭 ipv4로 연결을 시도하면된다.
EC2:Iaas서비스종류이다.
AWS의 EC2라는 Iaas서비스를 사용하여서 컴퓨팅 서버를 생성하고 접속 보안을 위해 ssh라는 프로토콜을 사용한다.

EC2:서버의 성능을 사용자가 선택하는 것이 가능. 성능이 높을수록 비용이 비싸다. 성능의 기준은 vCPU,Memory(ram),Storage(ssd,hdd),network로 구분 지을 수 있다.사용 목적에 따라 미리 정해진 규격을 인스턴스 타입으로 제공한다.
사용자는 EC2생성시 인스턴스 타입을 정한다.EC2는 사용목적에 따라 인스턴스 패밀리로 분류되며 패밀리 내부에서 세부적으로 타입을 지정한다.
범용 인스턴스 패밀리: M,T라인
컴퓨팅 최적화 패밀리: C
메모리 최적화 패밀리:R,X
스토리지 최적화 패밀리:I,D
엑셀러레이티드 컴퓨팅:P,G
EC2의 규격4가지
vCPU : EC2 인스턴스에 할당된 가상의 cpu 코어 개수(가상 cpu 코어 개수는 물리 cpu 코어의 쓰레드 개수를 뜻한다)
ex) 물리 cpu 코어가 3이고 코어당 2개의 쓰레드를 제공하면 vCPU는 6이된다.
개수가 높을수록 동신연산처리능력이 높다
Memory: RAM 용량을 나타내며 클수록 연산처리에 유리하다.
Storage: EC2인스턴스에서 사용할 수 있는 디스크 볼륨의 용량과 처리량,IOPS(input/output per Seconds)
-처리량 : 초당 데이터 전송 량
-IOPS: 초당 I/O 연산 처리 횟수
-처리량= IOPS * 연산 당(초당) 데이터 전송크기
ex)1000*4=4000Mbytes/Seconds
스토리지 중 EBS 범용 SSD타입일 경우 기본적으로 3000IOPS 및 125Mbyes/s성능을 보장한다. 성능은 반비례적으로 IOPS가 조절이 된 만큼 연산 당 데이터 전송크기가 줄어든다.
Network:초당 얼마의 데이터를 보낼 수 있는지를 결정 Gbps(Giga bit per seconds) 단위로 나타냄 더 빠른 네트워크 성능을 가진 인스턴스일수록 비용이 높아진다.
EC2 스토리지 선택사항: 인스턴스 스토어와 , EBS(Elastic Block Stroe)로 나뉜다.
인스턴스 스토어: 인스턴스와 같은 물리서버 내에 존재하기 때문에 속도가 빠르다. 인스턴스가 중지된다면 데이터가 날라간다. 데이터 영구보관이 불가하다. 종료하면 모든 데이터가 삭제된다. 물리 디스크에 문제가 발생시에 복구가 불가하다.
EBS: EBS용 물리서버와 인스턴스 스토어가 존재한 물리서버를 초고성능의 네트워크로 연결하여 사용한다. 데이터가 영구 보관된다. EBS 볼륨 즉 실제 물리서버에 문제가 발생시 데이터 복구가 가능하다. 스냅샷 기능(특정시점에 사진을 찍듯 서버를 저장하여 언제든지 서버를 되돌릴 수 있는 상태,다른 인스턴스와도 연결이된다)과 특정 시점 복구기능이 있다. EBS 볼륨내의 데이터들을 암호화가 가능하다. 탄력적 볼륨을 지원한다. (스토리지의 용량과 성능을 필요에 따라 조정할 수 있다.)
인스턴스 스토어의 사용 이유 : 인스턴스와 같은 물리서버내에 존재하여 접근 속도가 빠르기 때문에 빨리 데이터를 읽어들이고 저장할 필요가 적은 처리를 할 때 사용한다.
EBS 사용 이유: 데이터를 영구적으로 보관하고 안정성을 중요시하는 컴퓨팅 서비스를 사용하기 위해
컴퓨터에서 데이터를 저장하려면? 파일 시스템을 사용하여 물리디스크에 파일시스템을 설치하여 파일을 저장한다.
현재 시스템에 연결된 디스크를 볼 수 있는 명령어 : df -h
인스턴스 스토어 타입으로 스토리지 생성시: ephermera 이라는 단어가 들어간다.
명령어를 관리자 권한으로 실행할 때 sudo를 붙여준다 superUserDo
관리자 권한으로 생성한 파일(mkdir)을 chown로 사용자를 바꿔줘야한다.
sudo chown 유저이름:유저이름 생성한 파일이름
인스턴스 스토어의 경우 : 인스턴스 재부팅 시에는 데이터가 살아있으나 인스턴스가 중지될 경우 데이터가 전부 날라간다.
EBS의 경우: 인스턴스 생성시에 같은 데이터센터 내에 있어야하기 때문에 서브넷으로 명시적으로 어느곳에 위치 중인지 알려주어야 한다.
연결된 디스크를 확인하는 명령어 : lsblk
만들어진 파일시스템 목록을 확인하는 명령어: df- hT
EBS의 경우 볼륨을 추가해준다면 가용영역을 기존 가용영역과 맞춰야하고 별도로 IOPS와  처리량을 설정할 수 있다. 볼륨을 추가하여 만든 스토리지에는 파일시스템이 설치되어 있지 않으므로 별도 설치해주어야 하고 그때 사용하는 명령어가 “sudo mkfs.파일시스템종류(xfs,tmpfs등) 만들위치” 이다
ex)sudo mkfs.xfs /dev/xvdf
만들어주고 나서는 이 파일시스템이 사용되는 특정위치를 연결해주어야한다.
이때 사용되는 명령어는 “sudo mount /파일시스템이 설치된 위치 /연결한위치”
ex) sudo mount /dev/xvdf /home/ec2-user/test
EBS의 SnapShot 기능: 특정 시점에 서버를 완전히 copy하여 인스턴스가 종료되거나 삭제되어도 복구가 가능해진다. 만약 스냅샷 생성 후 루트 볼륨에서 작업을 하고 루트 볼륨 대체를 할 경우 기존 루트 볼륨에서 한 작업이 삭제된다.
관리자 권한으로 만들어진 파일은 무조건 sudo chown 사용자이름: 사용자그룹이름 파일이름 순으로 명령어를 실행시켜줘야한다.
스냅샷을 통해 복구를 하기위해선 마운트로 지정해준 파일시스템을 다시 뜯어내야한다. Sudo umount 현재디렉토리 명,그리고 콘솔창에서 볼륨 분리를 실행해준다. 그 후 스냅샷으로 복구한 후엔 이미 파일시스템이 만들어진 상태에서 스냅샷을 사용했기 때문에 mount만해주면 된다.

AWS에서 가상화 된 서버를 빌리는 컴퓨팅 서비스 중 가장 유명한게 EC2이다.  
사용자가 서버를 할당 받으려고 할 때 실제 물리서버를 엔지니어가 할당하는 것이 아닌 서버가상화 기술을 사용하여 물리서버를 가상화시켜 가상머신 위에서 작동하도록 사용자에게 제공한다. 사용자는 물리서버 사용과 차이를 느끼지못한다.
EC2는 서비스형 인프라(Iaas)로 사용자가 원하는 스펙 네트워크,스토리지등을 지정 할 수 있고 사용자는 이렇게 제공받는 IT리소스에 대하여 실제 물리적인 연결은 제외한 OS위에서의 작업만 사용자가 관리한다.
EC2는 서버의 성능에 따라 나뉘고 성능은 vCpu,Storage,Memory,Network로 구분된다.
인스턴스 타입은 인스턴스 패밀리로 분류되어 있고 같은 패밀리 내에서도 cpu나 memory같은 스펙적인 요소로 분류된다.

컴퓨팅 최적화: 주로 딥러닝,빅데이터에 처리되며 인스턴스 패밀리는 C
메모리 최적화: 메모리가 다른 인스턴스보다 월등히 크며 in-Memory상황을 사용해야할 때 쓴다.데이터를 많이읽어 오래쓸 때. 인스턴스 패밀리는 R,X
스토리지 최적화 빅데이터환경 I,D
엑셀러레이티드 컴퓨팅 P,G GPU같은 계산할 때 빠름
EC2의 스토리지 타입을 선택할 때 대부분 SSD타입의 스토리지를 사용하며 IOPS와 처리량이 높을수록 비용이 비싸진다. SSD가 Hdd보다 비싸다.

EC2를 이용하여서 컴퓨팅 자원을 배포한다.
sw/os는 AMI로 cpu/memory/network는 Instance Type(인스턴스 스토어 여부 포함)으로 storage -> EBS 나 인스턴스 스토어로

AMI(Amazon Machine Images)?이미지는 일종의 묶음을 뜻하며 일종의 소프트웨어 패키지(OS가 포함되어 있다)를 EC2서비스를 생성할 때 루트 볼륨에 설치하는 파일 AMI는 스냅샷 기능을 이용해 구현되어있다.

우리가 기존 EC2서비스를 만들 때 선택하여 넘기는 것은 Quick Start AMI로 자주 이용되는 소프트웨어를 설치한 OS이미지를 미리 만들어서 제공하는것이다. 사용자는 자신의 목적에 따라 AMI를 나누어 설정할 수 있다.
커스텀 AMI(My AMI)를 생성하여 동일한 환경의 인스턴스를 만들 수 있다.
자바설치 명령어 : sudo yum install java (y/N)
자바버전 확인 명령어 : java –version
인스턴스에서 이미지 생성 시:인스턴스를 기존처럼 생성하여 자바까지 설치한 것을 이미지화 시켜 AMI로 사용이 가능하다.
이미지를 만들 경우 인스턴스가 재부팅 되기 때문에 기존연결이 끊기게 된다.
AMI는 자동으로 스냅샷을 생성하기 때문에 AMI를 삭제할 경우 스냅샷 까지 삭제하여야 추가적인 비용이 청구되지 않는다.

인스턴스 스토어가 루트볼륨으로 잡혀있는 인스턴스의 경우 중지라는 개념이 없다고 생각해야한다.
최대절전 모드는 작업이 멈추지만 전원은 살아있어 우리가 사용했던 마지막 시점을 보존하고있다.
인스턴스 생성후 중지하면 인스턴스의 유형을 변경할 수 있다. 다시 인스턴스를 시작하면 인스턴스 유형이 변경되어 사용할 수 있다.

EC2 인스턴스 최대 절전 모드: 암호화된 EBS 볼륨이 루트볼륨으로 되어 있어야지만 절전모드를 사용할 수 있다.

인스턴스의 RAM에 우리가 사용중인 정보들이 있고 절전모드 시 이를 디스크영역으로 내려버린다(스냅샷의 원리와 비슷하다.)다시 인스턴스가 시작되면 디스크에 있던 내용들을 RAM에 올려 실행한다.
사용하는 이유:비용이 절감된다.(최대절전모드에서는 비용을 지불하지 않는다) 중지와 비슷하다.
최대절전모드를 사용하기 위한 필수 권장
최대절전모드는 특정 AMI와 특정 인스턴스패밀리에서만 작동한다.
암호화된 EBS 루트 볼륨에서만 사용가능하고 최대 150GB RAM까지 사용가능하다. 또한 램의 내용을 디스크에 저장하기 때문에 디스크(루트볼륨 Storage)의 크기가 RAM의 크기보다 커야한다. 또한 인스턴스 생성시 최대절전 모드를 활성화 해주어야지 기능 사용이 가능하다.

현재 서버가 통신이 가능한지에 대한 명령어: ping 웹사이트주소
이를 파일형태로 담기 : ex)ping www.google.com > ping.log &
&은 백그라운드 환경에서 실행한다는 뜻
tail -f ping.log: 파일의 마지막 부분만 계속 콘솔창에 출력
ps -ef | ping : 현재 실행중인 프로세스중에 ping이 들어간 프로세스를 찾음

최대 절전 모드일 경우에는 백그라운드에서 실행중인 프로세스가 있다면
프로세스가 종료되지않고 멈추었다가 인스턴스가 다시 시작될 때 작동함
EC2실행시 사용자 스크립트를 실행 할 수 있다.
이 스크립트는 인스턴스가 최초 실행 시 한번만 실행된다.
#!/bin/bash bash쉘 형태로 데이터를 실행시킨다.
모든 설치파일업데이트 명령어: yum update -y
사용자 데이터 스크립트가 재부팅 할 때 마다 실행되도록 지정하는 명령어
-[script-user,always]
#!/bin/bash
/bin/echo “booted” >> /home/ec2-user/result.txt

EC2 접속을 위한 SSH키 페어
키 페어: 인스턴스에 대한 ssh 연결을 위해 인스턴스 시작 시 기존 키 페어를 지정하거나 또는 새 키페어를 생성
ppk,rsa Putty 프로그램에서 사용되는 키형식
키를 분실할경우 인스턴스 종료 후 다른 키로 대체해야함

탄력적 IP(Elastic IP)
EC2인스턴스에 고정 Public Ip를 부여하기 위해 사용된다.
인스턴스가 중지되었다가 다시 시작될 시에 퍼블릭 Ipv4 주소와 외부 DNS 호스트 이름이 변경된다면 유동IP
프라이빗 Ipv4주소와 내부 DNS 호스트이름은 변경되지 않는다.
영구 퍼블릭 IP주소가 필요한 경우: 탄력적 IP를 인스턴스에 연결하여 고정 Ip를 확보
탄력적 Ip주소의 특성: 인스턴스에 할당이 가능하며 IP주소를 연결해제할 때 까지는 인스턴스의 IPv4주소로 사용됨. 할당된 IP주소는 릴리스할때까지 아마존 계정에 남아있게 되고 인스턴스에 할당되지 않은 채 Elastic Ip가 방치되어 있다면 비용이 지불된다. 하나의 인스턴스에 하나의 Elastic Ip를 할당하는 것 까지는 무료이지만 2개이상부터는 비용이 지불되고 재매핑(IP를 할당했다가 연결해제했다하는것)이 100번을 넘는순간 비용이 지불된다.

EC2서버 모니터링
EC2 관리콘솔 화면에서 서버로그확인 기능이 제공된다.
Amazon CloudWatch를 사용하여 EC2 인스턴스 모니터링
실시간에 가까운 지표가 제공되며 EC2 콘솔 모니터링 탭에서 볼 수 있는 차트가 제공된다. 데이터는 15개월 동안 유지된다.
기본 모니터링
기본으로 제공되는 모니터링 기술이며 추가 비용이 없고 5분마다 CloudWatch로 데이터가 전송된다.
세부 모니터링
미리 선택한 7개의 지표에 대하여 고정적인 월별 요금이 청구된다
1분마다 지표데이터가 전송된다.

EC2 인스턴스의 로그 살펴보기
1.작업 탭 -> 모니터링 및 문제해결 -> 시스템 로그 가져오기
2. 러너랩 환경에서 로그를 보고싶은 인스턴스에 ssh로 서버연결 후
   sudo dmesg -w 명령어로 로그메세지 확인가능
3. 러너랩 환경에서 로그를 보고싶은 인스턴스에 ssh로 서버연결 후
   tail -f /var/log/messages
   dmesg는 서버 커널 부분의 로그를 표시해주고 tail 명령어는 서버 설정부터의 로그

네트워킹: 컴퓨터 사이를 연결하여 서로 통신할 수 있게 되는 것
인터넷: 작은 네트워크들을 서로간에 연결하여 거대한 네트워크를 구축한 것
단일화된 방법으로 프로토콜이라는 통신규격을 정함
TCP/IP프로토콜을 사용
인트라넷: 특정 집단에서만 사용하는 내부 네트워크 허가받은 사용자만 접근이가능하다.
네트워크에선 서로를 구분하기위한 유일 구분자가 필요함 이를 IP(Internet Protocol address)라는 값이 담당함

IPv4기준으로 ip주소는 총 32bit가 할당된다.
이는 네트워크에 속하는 컴퓨터가 가질 수 있는 ip주소가 정해져 있고 ip주소를 범위로 나타내어 범위내에서만ip주소가 할당 가능하다.
이범위를 IP CIDR(Classless Inter-Domain Routing)Block 이라고한다.
ex)192.168.0.0/24 뒤의 8자리를 IP주소 범위로 사용하겠다는 의미
할당범위는 2^8 총 256자리의 ip주소가 할당된다.
네트워크 분리의 필요성
네트워크를 분리하지않고 하나의 네트워크에 모든 장비를 연결할 경우 연결된 장비들에 대한 부하가 상당히 높아짐 예를 들어 특정 IP에 값을 전달하기위해서 네트워크에 연결된 모든 장비에 확인을 거치는 과정이 필요해져 장비의 부하가 점점 심해짐. 또한 특정 네트워크가 대규모 IP를 점유하게 된다면 다른 곳에서 사용할 수 없음. 이는 서로다른 네트워크를 연결할 때도 적용됨.
서브넷
전체 네트워크를 작은 여러 개의 네트워크로 분할하는 기능으로 각 서브넷은 전체 네트워크 IP범위의 일부분으로만 지정가능하다. 각 서브넷간에는 IP가 겹치면 안되나 크기는 다를 수 있다.

AWS VPC
AWS에서 독립적인 네트워크를 구성하는 방법으로 사용
VPC 서비스를 이용하여 내부 네트워크 영역을 구성할 수 있다.
VPC는 네트워크 기반을 만들어주는 서비스이다.
온프레미스 환경에서 내부의 서버들끼리 통신할 수 있는 독립된 네트워크가 구성된 것처럼 VPC역시 해당 AWS계정에 독립된 네트워크를 구성하는것이다.
독립된 네트워크를 외부나 AWS 서비스,혹은 다른 VPC 네트워크와 연동하기위해선 별도의 설정이 필요하다.

기본 VPC
계정 최초 생성시 기본 VPC가 생성된 채로 제공된다.
해당 VPC는 인터넷 게이트웨이 설정이 되어있어 인터넷망에 연결된 상태이며 EC2 인스턴스를 할당한다면 인터넷 사용이 가능하다.별도의 네트워크 구성을 위해선 커스텀 VPC가 필요.
커스텀 VPC 생성시 IP CIDR BLOCK의 Ip network prefix는 16~28 사이만 가능
라우팅 테이블
라우팅 테이블은 라우터의 역할을 수행하며 VPC 내부에서 EC2인스턴스에서 대상 혹은 목적지를 찾기위한 경로를 저장한 테이블
기본라우팅 테이블
VPC는 기본 라우팅 테이블이 생성되며 별도로 생성한 라우팅테이블에 연결하지않으면 기본라우팅테이블이 생성된다.
라우팅테이블에 라우팅이 192.168.0.0/24가 local로 되어있고 0.0.0.0/0이 인터넷게이트 웨이와 연결되어있다면 192.168.0.0/24로 들어온 요청은 local 에서 찾고 그외의 요청은 인터넷에서 찾는다는 뜻이다.

NIC: 컴퓨터가 네트워크에 연결되기 위해서는 네트워크 인터페이스 카드(NIC)가 필요하다. NIC에는 실제 IP가 할당되고 이를통해 컴퓨터간에 실제 통신이 이루어진다.
이와 같은 개념이 AWS에도 존재한다. AWS에서는 ENI를 통해 EC2 인스턴스에 네트워크 카드를 가상으로 연결한다.
ENI(Elastic Network Inerface):EC2 인스턴스 생성시에 기본 ENI가 연결되어 생성되기 떄문에 해제가 불가하다. 현재 내가 포함된 서브넷의 IP 대역 중 하나가 EC2 인스턴스의 ENI에 할당되면서 네트워크에 연결
공인 IP(Public IP)또한 ENI에 연결되며 사설IP(private IP)도 연결되어 쌍으로 연결된다.

DHCP(Dynamic Host Configuration Protocol)
네트워크에 연결된 장치에 자동으로 IP를 할당해주는 서비스
VPC 생성시에 기본적으로 DHCP 서비스가 작동하고 VPC에서 설정한 서브넷의 IP대역내에서 랜덤으로 IP(사설IP)를 할당해준다.

퍼블릭 서브넷과 프라이빗 서브넷으로 분리하여 필요한 이유
퍼블릭서브넷이란?라우팅 테이블을 통해 인터넷 게이트웨이와 연결된 서브넷
프라이빗 서브넷이란? 인터넷 게이트웨이와 연결되지않은 서브넷 즉, 인터넷에 연결되지 않은 서브넷이다.
프라이빗 서브넷이 왜필요한가? 모든 서브넷이 인터넷에 연결되어 있을경우 항상 공격의 대상이된다. 그렇기 때문에 인터넷에 연결되지 않아도 되고 데이터베이스와 같이 중요한 데이터를 관리해야 하는 서버는 인터넷이 닿지않는 격리된 위치위 놓는 것이 보안원칙이다

퍼블릭 서브넷과 프라이빗 서브넷 생성 방법
라우팅 테이블을 서로 다르게 설정한다. 퍼블릭 서브넷으로 만들고 싶은 서브넷의 라우팅 테이블에만 인터넷 게이트웨이를 연결하여준다.
퍼블릭 서브넷을 EC2 인스턴스를 통하여 인터넷 연결을 확인하기위해서 인스턴스 생성시에 인스턴스의 Public Ip는 자동할당이아닌 EIP를 통해 연결해야한다.
프라이빗 서브넷에 위치한 인스턴스에 접근하는 방법
-Bastion Host : 외부에서 접근가능한 EC2인스턴스로서 내부 네트워크에 위치한 서버에 접속하기 위한 접속전용 호스트이다.서비스 운영이 목적이아닌 작업을 위한용도(접속작업)을 위한용도로만 사용된다.
Bastion Host로 프라이빗 서브넷에 접속하는방법
1.	Bastion Host에 private key를 복사한다.
      	Scp -i ~/.ssh/labsuser.pem ~/.ssh/labsuser.pem ec2-user@Public IP:/복사시키고 싶은 경로
2.	바스티온 호스트에 접속한다
      	ssh -i ~/.ssh/labsuser.pem ec2-user@Public IP
3.	BastionHost에서 프라이빗 서브넷의 서버로 접속
      	ssh -i labsuser.pem ec2-user@Private IP
      위 방법으로 프라이빗 서브넷의 서버로 접속이 가능하다.
      하지만 이역시 ssh key를 강탈당할 경우 bastion host에 저장된키 모두 강탈당할 수 있어 위험하다. 이 절차를 손쉽게 더욱 보안성이 뛰어나게 처리하는 SSH agent forwarding이라는 방법이있다. 하지만 leraner lab환경에서는 실습이 불가

퍼블릭 서브넷과 프라이빗 서브넷을 같은 가용영역에 두는이유?
가용영역은 물리적 데이터 센터를 의미하며 같은 가용영역간에 통신은 비용이 발생하지않고 가용영역이 다를경우 비용을 지불해야한다. 또한 고가용성을 보장받기 위함이기도하다.

퍼블릭 서브넷과 프라이빗 서브넷에서 고가용성은 서비스가 끊기지 않고 계속 서비스된다.는 것을 의미한다.

가용성이 확보되지 못했다: 서버에 에러가 날 경우 모든 서버가 마비되는 것

포트의 필요 이유와 포트가 무슨 역할을 하는지 그리고 공인 IP와 NAT에 관하여
공인IP : 여러 개의 네트워크의 집합인 인터넷에서 IP를 이용해 서로를 구분한다.
인터넷을 사용하기 위해선 무조건적으로 공인 IP가 있어야한다.이는 ICANN이라는 국제 기구에서 초괄하고 한국에선 KISA가 이를 위임 받아 처리한다.
공유기에는 ENI처럼 IP대역과 퍼블릭 IP를 둘다 가지고있다. 하지만 공유기에 연결된 기기는 공인Ip를 할당받지 않는데 어떻게 인터넷 사용이가능한가? 이를 해주는 역할은 NAT이라는 녀석이 담당한다. 공유기에 연결된 기기에서 인터넷 사용을 요청할 경우 중간 공유기에서 공유기의 공인IP를 가지고 인터넷에 요청을 하게된다.중간 대리자 역할을 진행해준다.
NAT(Network Address Translation)이라는 뜻으로 공유기에서 내부에 연결된 장치들이 인터넷으로 접근할 떄 공유기에 할당된 공인 Ip를 이용하도록 지원해주는 것
이를통해서 공유기에 연결된 내부기기들은 공인IP를 할당받지않아도 인터넷을 사용할 수 있는것이다.
하지만 공유기는 어떻게 스마트폰에서 인터넷요청을 했으면 했다고 기억을 할 수 있는가? 이때 사용되는게 포트이다.
하나의 컴퓨터에서 네트워크를 사용하는 어플리케이션이 여러 개일 경우 IP처럼 ID역할을 수행해주는 것이 포트이며 포트도 IP처럼 유일하여야한다.
네트워크에 연결되 내부기기들의 포트번호와 공유기의 공인IP와 포트번호 목적지까지 저장해놓는 테이블이있어서 이를 기억할 수있다. 이를 NAT Table또는 매핑 테이블이라고한다. 이를 통해 요청에 대한 응답이 올바른 장치로 전달될 수 있도록 지원해주는 것이다.NAT을 이용해서 하나의 공인 IP로 여러대의 기기가 인터넷에 접속이 가능해진다.
NAT의 개념은 기본적으로 공유기 내부의 기기에서 인터넷으로 요청하는 것은 가능하나 인터넷에서 특정기기를 선택하여 접속하는 것은 불가능하다. 공유기를 특정하여 접속을 시도하는 것은 가능하지만 공유기에 연결되어있는 기기를 특별징저 접속하는 것은 불가능하다. 외부에서 사용을 하고 싶다면 공유기 쪽에서 포트포워딩을 설정하여 접근은 할수있지만 인터넷입장에서는 공유기로 밖에 접속하는걸로 보이지않는다.
NAT 게이트웨이
프라이빗 서브넷에서 Nat게이트웨이를 사용하면 인터넷에서 접근이가능하다. 하지만 인터넷에서 Nat을 이용해 프라이빗 서브넷에 접근하는 것은 불가능하다.
퍼블릭 서브넷에서 프라이빗 서브넷 의 퍼블릭 Ip로 접근을 할경우 프라이빗 IP는 인터넷이 되지않기 떄문에 경로를 찾지못하고 인터넷에 떠돌아다니게됨
NAT게이트웨이는 퍼블릭 서브넷 쪽에 존재하게되고 라우팅 테이블에서 이를 설정해주면 프라이빗 서브넷 도 인터넷으로 나갈 수 있다.

EC2 인스턴스는 접근할 수 있는 대상을 제한하여 공격에 대한 대비를 할 수 있다. 접근하는 대상을 제한하지 않는다면 전세게 어디서든 공인IP를 보유한 EC2 인스턴스에 접속이가능해진다.
그렇기에 우리는 보안그룹을 통해 인스턴스를 보호해야한다.
인바운드/아웃바운드규칙을 통해 들어오고 나가는 트래픽을 보호한다.
트래픽: 네트워크를 통해 교환되는 *패킷의 흐름
패킷:네트워크를 통해 장치간에 교환되는 데이터
아웃바운드 규칙:EC2 인스턴스에서 다른 장치로 나가는 패킷에 대해 제어한다. 또한 통신하려는 기기에 지금 접근이 접근이 가능한지 1차적 파악후 접근을 시도한다.
인바운드 규칙: 다른장치에서 EC2인스턴스로 접근하는 패킷에 대해 제어한다.
보안그룹 설정에서 아웃바운드 인바운드에 아무 규칙도 넣지않는다면 어떤 트래트래 허용되지 않는 것을 얘기한다.
Ex)아웃바운드를 0.0.0.0/0으로 허용해놓는다면 외부로 나가는 모든 트래픽에대해 허용한다는 뜻이다. 만약 VPC의 IP CIDR BLOCK이 192.168.0.0/24이고 아웃트래픽이 192.168.0.0/24라면 현재의 VPC의 서브넷에서 나가는 트래픽에 대해서만 허용한다는 뜻이다.
다만 예외적으로 아웃바운드가 허용된 곳으로 보낸 요청에 대한 응답은 인바운드 규칙에 걸리지않는다. 단,외부에서 시작된 요청은 규칙에 걸린다.

EX)인바운드를 0.0.0.0/0으로 해놓는다면 모든 네트워크에서 접근이 가능하다.


Ec2인스턴스는 보안그룹으로 감싸져잇고 다른대상과 통신할 때 무조건 보안 그룹을 통해야한다. 보안그룹의 아웃바운드 규칙이라는 것으로 통신하려는 기기에 1차적으로 통신이 가능한지 검사하고 인바운드 규칙은 통신한기기에서 넘어오는 반환값(response)을 받는 경로를 설정하는 부분 아웃바운드와 인바운드에 아무 규칙이 없으면 어떤 트래픽도 허용되지않는다. EC2인스턴스에서 발송한 값은 인바운드 아웃바운드에 적용이되지만 요청으로 나갔다가 응답 값으로 들어오는 경우에는 인바운드 규칙을 무시한다.
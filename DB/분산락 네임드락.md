## 동시성 제어와 Lock을 써야하는 이유
- 동시성을 제어하지 않음으로서 발생하는 데이터베이스의 DisConnection이나 서비스 자체의 장애를 유발할 수 있는 상황을 방지하고자
- **Race Condition(경쟁상태)**
  - 두 개 이상의 스레드가 동시에 같은 데이터를 접근하여 값을 수정할려고 할때, 데이터의 예상치 못한 변경이 발생할 수 있다.
- **Dead Lock**
  - 두 개 이상의 스레드가 서로의 작업이 완료될 때까지 기다리면서 결국 아무도 완료되지 않는 문제가 발생할 수 있다.
  - 서비스 레벨에서는 애플리케이션 구동이 중지될 수도 있다.
- **Data Corruption**
  - 두 개 이상의 스레드가 동시에 같은 데이터에 접근하여 값을 변경할 때, 예상치 못한 데이터의 변형이 발생할 수 있다.

## 동시성의 정의
- **싱글 코어에서 멀티 스레드를 동작시키기 위한 방식으로, 멀티 태스킹을 위해 여러 개의 스레드가 번갈아가면서 실행되는 성질을 말한다.**
  - 반대로 코틀린은 싱글스레드에서 코루틴을 통해 동시성을 만족
  - 멀티 스레드로 동시성을 만족시킬 수 있는 것이지 동시성과 멀티 스레드는 연관이 없다
- **동시에 실행되는 것처럼 보이는 것**
  - 멀티 코어에서 멀티 스레드를 이용하여 동시성을 만족할 경우에는 실제 물리적 시간으로 동시에 실행된다.
  - 싱글 코어에서 멀티 스레드를 이용해 동시성을 구현하는 일부 케이스에 대한 내용

## Named Lock
- MySQL에서 사용되는 락 방법 중 하나로, 이름을 가진 메타 데이터 락이다.
- 각각의 락에 이름을 가지고, 해당 락이 해제될 때까지 다른 세션은 해당 락을 획득하지 못한다.
- 트렌잭션이 만료되면 락이 자동으로 해제되지 않기에 락을 해제시켜 주거나 선점시간이 종료되어야 해제된다는 특징이 있다.
- MySQL에서는 GET_LOCK()을 통해 락을 획득할 수 있고, RELEASE_LOCK()을 통해 해제
- 네임드락(GET_LOCK)의 사용 용도는 주로 분산 락에서 사용

### Named Lock 사용목적
- 트랜잭션 범위(Transaction Scope)를 넘어서서 특정 자원에 대한 락을 유지하고, 다음 트랜잭션이 해당 락을 재사용하여 데이터의 일관성을 유지할 수 있도록 만드는 것입니다.
- 여러 트랜잭션이 동일한 데이터나 자원에 대한 작업을 수행하는 경우, 이러한 트랜잭션 간에 데이터 일관성을 유지해야 할 때 네임드락을 사용
- 동시성 제어 메커니즘과 함께 사용되어 트랜잭션 간의 충돌을 방지하고 데이터 일관성을 보장하기 위한 도구로 활용
- 데이터베이스 및 다중 스레딩 환경에서 데이터의 정확성과 무결성을 유지

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbvV2YX%2FbtrXOsSP9aL%2FYnDhV2PerK4p3l1ZvKKBFK%2Fimg.png)

- 위 그림을 보면  Session-1 , Session-2가 Stock에 동시적으로 요청을 보낼 시, 이때 락을 **Stock에 거는 것이 아닌, 별도의 공간에 Lock**을 걸게 된다.
- 이렇게 Lock을 걸게 되면 Session-2는 Session-1이 ‘1’이라는 이름으로 LOCK을 걸게 된다면 Session-2는 Session-1이 해제된 이후에 LOCK을 획득

## 분산 락(Distributed Lock)
- 스프링 애플리케이션은 기본적으로 **멀티스레드 환경**에서 구동된다.
- 여러 스레드가 함께 접근할 수 있는 공유 자원에 대해 Race condition이 발생할 가능성을 배제해야한다.
- 자바는 synchronized라는 키워드를 언어차원에서 제공하여, 모니터 기반의 **상호배제 기능을 제공**한다.
  - 하지만 해당 매커니즘은 같은 프로세스 내의 스레드에 한해서만 지원된다.
- 일반적인 웹 서비스의 서버는 다중화하여 부하 분산 처리를 하기에 분산 환경 속에서 상호 배제를 구현하여 동시성 문제를 다루기 위해 등장한 방법이 바로 분산락이다.
- 여기서 알아야 할 사항은 분산락은 DB에서 제공하는 락의 종류가 아니다.
  - 데이터베이스를 가장 많이 사용하기에, 데이터베이스에 대한 동시성 문제를 분산락으로 풀어내는 사례가 많을 뿐

### 분산락 구현방법
- 분산 락을 구현하기 위해 락에 대한 정보를 임의적으로 보관해야한다.